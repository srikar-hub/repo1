tmsrvtagThreadHandle=setInterval(function () {
    if(typeof(window.tmsrv)!=='undefined'&&typeof(window.tmsrv.instances)==='undefined') {
        boot();
    }
    if(typeof(window.tmsrv)!=='undefined'&&typeof(window.tmsrv.cmd)!=='undefined'&&window.tmsrv.cmd.length>0) {
        window.tmsrv.createAdUnit(window.tmsrv.cmd.pop());
    }
}, 1);
function boot() {
    window.tmsrv.createAdUnit = function (adDataFunction) {
        var tmp = new window.tmsrv.adClass();
        adDataFunction(tmp);
        window.tmsrv.instances.push(tmp);
    };
    window.tmsrv.js=[];
    //window.tmsrv.ASU='https://vsrv-srv.tmadsrv.com/ads';
    window.tmsrv.ASU='https://vsrv-srv.tmadsrv.com/ads';
    //video
    window.tmsrv.sendBeacon=function(jsonRequest) {
        if(navigator.sendBeacon(window.tmsrv.ASU+"/"+jsonRequest.what,JSON.stringify(jsonRequest))==false) {
            window.tmsrv.sendBeacon(jsonRequest);
        }
    };
    window.tmsrv.IHB='https://hb-rpt.tmadsrv.com/api/v1/events';
    window.tmsrv.ASU_Re='https://vsrv-rpt.tmadsrv.com/api/v1/events';
    window.tmsrv.Schain='';
    window.tmsrv.instances=[];
    window.tmsrv.instancesMetadata=[];
    window.tmsrv.schainJson;
    window.tmsrv.header_bidding=false;
    window.tmsrv.getRandomInt=function (min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; };

    window.tmsrv.generateId = function () {
        var ts = (+new Date).toString();
        var parts = ts.split('').reverse();
        var id = '';
        for (var i = 0; i < 8; ++i) {
            var index = window.tmsrv.getRandomInt(0, parts.length - 1);
            id += parts[index];
        }
        return id;
    };

    window.tmsrv.schain = function (data, callback) {
        //var schainJsonData='domain='+data.adomain;
        const schainhbdata = data.header_bidding;
        var schainJsonData = {
            domain: data.adomain,
            bidders: schainhbdata.map(p => ({
                bidder: p.bidder,
                operationalDomain: p.operational_domain
            }))
        };
        //console.log("Schain Request:", schainJsonData);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                data.header_bidding_schain = JSON.parse(xhr.responseText).header_bidding_schain;
                //console.log("Schain Responce:", xhr.responseText);
                callback(data);
            }
        }
        xhr.open("POST", window.tmsrv.Schain);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(schainJsonData));
    };

    window.tmsrv.IHBRep = function (eventType, data, callback) {
        var ihbReqData = {};
        ihbReqData.eventType = eventType;
        ihbReqData.eventData = data;
        //console.log("IHB Request:", ihbReqData);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                //console.log("IHB Responce:", xhr.responseText);
                //callback(xhr.responseText);
            }
        }
        xhr.open("POST", window.tmsrv.IHB);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(ihbReqData));
    };

    window.tmsrv.getWindowFromIframe = function (iframe) {
        var doc;
        if (iframe.contentWindow) {
            return iframe.contentWindow;
        }
        if (iframe.window) {
            return iframe.window;
        }
        if (iframe.contentDocument) {
            doc = iframe.contentDocument;
        }
        if (!doc && iframe.document) {
            doc = iframe.document;
        }
        if (doc && doc.defaultView) {
            return doc.defaultView;
        }
        if (doc && doc.parentWindow) {
            return doc.parentWindow;
        }
        return undefined;
    };

    window.tmsrv.viewability = function (e) {
        var viewability = 0;
        try {
            var viewport = {
                top: window.tmsrv.W.pageYOffset,
                bottom: window.tmsrv.W.pageYOffset + window.tmsrv.W.innerHeight
            };
            var elementBoundingRect = e.getBoundingClientRect();
            var elementPos = {
                top: elementBoundingRect.y + window.tmsrv.W.pageYOffset,
                bottom: elementBoundingRect.y + elementBoundingRect.height + window.tmsrv.W.pageYOffset
            };
            if (viewport.top > elementPos.bottom || viewport.bottom < elementPos.top) return 0;
            if (viewport.top < elementPos.top && viewport.bottom > elementPos.bottom) return 100;
            if (elementPos.top < viewport.top && elementPos.bottom > viewport.bottom) return 100;
            var elementHeight = elementBoundingRect.height;
            var elementHeightInView = elementHeight;
            if (elementPos.top < viewport.top) {
                elementHeightInView = elementHeight - (window.tmsrv.W.pageYOffset - elementPos.top);
            }
            if (elementPos.bottom > viewport.bottom) {
                elementHeightInView = elementHeightInView - (elementPos.bottom - viewport.bottom);
            }
            var percentageInView = (elementHeightInView / window.innerHeight) * 100;
            viewability = Math.round(percentageInView);
        } catch (ex) {
        }
        return viewability;
    };
    window.tmsrv.enableLog = function (flag) {
        window.tmsrv.enableLog = flag;
    };
    window.tmsrv.log = function (json) {
        if (window.tmsrv.enableLog == false) return;
        var obj = null;
        if (arguments.length > 0) {
            obj = arguments[0];
        } else {
            console.clear();
        }
        var dt = new Date();
        var ts = 'TMSRV:[' + dt.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true }) + '] ';
        if (typeof obj === 'string') {
            console.log(
                '%c%s%c %s','color:#e0f7fa;background:#263238;padding:2px 6px;border-radius:3px;font-weight:bold;', ts, 'color:#fff3e0;background:#546e7a;padding:2px 6px;border-radius:3px;margin-left:4px;font-weight:bold;', obj);
        } else {
            console.log('%c%s', 'color:#e0f7fa;background:#263238;padding:2px 6px;border-radius:3px;font-weight:bold;', ts);
            console.log(obj);
        }
    };
    window.tmsrv.httpGet = function (url, callback, context) {
        var ajaxRequest = null;
        try {
            //Opera 8.0+, Firefox, Safari
            ajaxRequest = new window.tmsrv.W.XMLHttpRequest();
        } catch (e) {
            try {
                //Internet Explorer Browsers
                ajaxRequest = new window.tmsrv.W.ActiveXObject("Msxml2.XMLHTTP");
            } catch (ex) {
                try {
                    ajaxRequest = new window.tmsrv.W.ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                }
            }
        }
        if (ajaxRequest == null) {
            throw "[ web browser error ]";
        }
        ajaxRequest.onreadystatechange = function () {
            if (ajaxRequest.readyState === window.tmsrv.W.XMLHttpRequest.DONE) {
                if (ajaxRequest.status === 200) {
                    callback(JSON.parse(ajaxRequest.responseText), context);
                } else if(ajaxRequest.status==204) {
                    throw "[ TapMind setup error ]";
                } else {
                    throw "[ TapMind server error ]";
                }
            }
        };
        ajaxRequest.open("GET", url);
        ajaxRequest.withCredentials = true;
        ajaxRequest.setRequestHeader('Accept','text/plain');
        ajaxRequest.setRequestHeader('Content-Type','text/plain; charset=UTF-8');
        ajaxRequest.send();
    };
    window.tmsrv.httpPost = function (url, jsonData, callback, context) {
        var ajaxRequest = null;
        try {
            //Opera 8.0+, Firefox, Safari
            ajaxRequest = new window.tmsrv.W.XMLHttpRequest();
        } catch (e) {
            try {
                //Internet Explorer Browsers
                ajaxRequest = new window.tmsrv.W.ActiveXObject("Msxml2.XMLHTTP");
            } catch (ex) {
                try {
                    ajaxRequest = new window.tmsrv.W.ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                }
            }
        }
        if (ajaxRequest == null) {
            throw "[ web browser error ]";
        }
        ajaxRequest.onreadystatechange = function () {
            if (ajaxRequest.readyState === window.tmsrv.W.XMLHttpRequest.DONE) {
                if(ajaxRequest.status==200) {
                    callback(JSON.parse(ajaxRequest.responseText), context);
                } else if(ajaxRequest.status==204) {
                    throw "[ TapMind setup error ]";
                } else {
                    throw "[ TapMind server error ]";
                }
            }
        };
        ajaxRequest.open("POST", url);
        ajaxRequest.withCredentials = true;
        ajaxRequest.setRequestHeader('Accept','text/plain');
        ajaxRequest.setRequestHeader('Content-Type','text/plain; charset=UTF-8');
        ajaxRequest.send(JSON.stringify(jsonData));
    };

    window.tmsrv.substituteMacro = function (tag) {
        var domain = (new URL(data.url)).hostname;
        tag = tag.replaceAll('[DOMAIN]', domain);
        return tag;
    };

    window.tmsrv.resize = function (element, alignment, percentage) {
        percentage = percentage / 100.0;
        var transformOrigin = '0% 0%';
        var transform = 'scale(' + percentage + ',' + percentage + ')';
        if (alignment == 'left') {
            element.style.left = '0%';
        } else if (alignment == 'center') {
            element.style.left = '50%';
            transform += ' translate(-50%,0%)';
        } else if (alignment == 'right') {
            element.style.right = '0%';
        }
        element.style.webkitTransformOrigin = transformOrigin;
        element.style.mozTransformOrigin = transformOrigin;
        element.style.msTransformOrigin = transformOrigin;
        element.style.oTransformOrigin = transformOrigin;
        element.style.transformOrigin = transformOrigin;
        element.style.transformOrigin = transformOrigin;
        element.style.webkitTransform = transform;
        element.style.mozTransform = transform;
        element.style.msTransform = transform;
        element.style.oTransform = transform;
        element.style.transform = transform;
    };

    window.tmsrv.resizeInt = function (element, alignment, percentage) {
        percentage = percentage / 100.0;
        var transformOrigin = '0% 0%';
        var transform = 'scale(' + percentage + ',' + percentage + ')';
        if (alignment == 'left') {
            element.style.left = '0%';
        } else if (alignment == 'center') {
            element.style.left = '50%';
            transform += ' translate(-50%,-50%)';
        } else if (alignment == 'right') {
            element.style.right = '0%';
        }
        element.style.webkitTransformOrigin = transformOrigin;
        element.style.mozTransformOrigin = transformOrigin;
        element.style.msTransformOrigin = transformOrigin;
        element.style.oTransformOrigin = transformOrigin;
        element.style.transformOrigin = transformOrigin;
        element.style.transformOrigin = transformOrigin;
        element.style.webkitTransform = transform;
        element.style.mozTransform = transform;
        element.style.msTransform = transform;
        element.style.oTransform = transform;
        element.style.transform = transform;
    };

    window.tmsrv.clickTrack = function () { };
    window.tmsrv.refreshedImpression = function () { };
    window.tmsrv.createIframe = function (parent, doc, width, height, content, adData, callback) {
        var html = '';
        html += '<!doctype html>';
        html += '<html>';
        html += '<head>';
        html += '</head>';
        html += '<body topmargin=0 leftmargin=0 marginwidth=0 marginheight=0>';
        html += decodeURIComponent(escape(content));
        html += '</body>';
        html += '</html>';
        parent.innerHTML = "";
        var adIframe = doc.createElement('iframe');
        parent.appendChild(adIframe);
        adIframe.setAttribute('width', width);
        adIframe.setAttribute('height', height);
        adIframe.setAttribute('allow', 'autoplay;fullscreen;');
        adIframe.setAttribute('frameborder', 0);
        adIframe.setAttribute('scrolling', 'no');
        adIframe.setAttribute('marginheight', 0);
        adIframe.setAttribute('marginwidth', 0);
        adIframe.style.width = width + 'px';
        adIframe.style.height = height + 'px';
        adIframe.style.margin = '0px';
        adIframe.style.padding = '0px';
        adIframe.style.overflow = 'hidden';
        adIframe.tmsrv = window.tmsrv;
        if (typeof (adData) !== 'undefined' && adData != null) {
            adIframe.adData = adData;
            adIframe.adCode = window.tmsrv;
        }
        if (typeof (callback) !== 'undefined' && callback != null) {
            adIframe.callback = callback;
        }
        var adIframeCtl = window.tmsrv.getWindowFromIframe(adIframe);
        adIframeCtl.document.open();
        adIframeCtl.document.write(html);
        adIframeCtl.document.close();
        return adIframe;
    };

    window.tmsrv.isWindow = function (obj) { return obj != null && obj === obj.window; };
    window.tmsrv.getWindow = function (elem) { return window.tmsrv.isWindow(elem) ? elem : elem.nodeType === 9 && elem.defaultView; };

    window.tmsrv.offset = function (elem) {
        var docElem, win,
            box = { top: 0, left: 0 },
            doc = elem && elem.ownerDocument;
        docElem = doc.documentElement;
        if (typeof (elem.getBoundingClientRect) !== typeof (undefined)) {
            box = elem.getBoundingClientRect();
        }
        win = window.tmsrv.getWindow(doc);
        return {
            top: box.top + win.pageYOffset - docElem.clientTop,
            left: box.left + win.pageXOffset - docElem.clientLeft
        };
    };

    window.tmsrv.getDim = function (element) {
        return {
            width: element.getBoundingClientRect().width,
            height: element.getBoundingClientRect().height,
            left: window.tmsrv.offset(element).left,
            top: window.tmsrv.offset(element).top
        };
    };

    window.tmsrv.adClass = function () {
        this.instanceId = window.tmsrv.generateId();
        this.user_consent = 0;
        this.partner_id = null;
        this.publisher_id = null;
        this.ad_unit_id = null;
        this.ad_unit_name = null;
        this.width = null;
        this.height = null;
        this.root = null;
        this.domain = null;
        this.enableLog = true;
        this.clickUrl = null;
        this.log = function () {
            if (this.enableLog == false) return;
            var obj = null;
            if (arguments.length > 0) {
                obj = arguments[0];
            } else {
                obj = this;
            }
            var dt = new Date();
            var ts = '[' + dt.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true }) + '] ';
            if (this.ad_unit_name != null) {
                ts += '(' + this.ad_unit_name + ') ';
            }
            if (typeof (obj) === 'string') {
                console.log('%c%s%c%s', 'color:blue;border:1px outset white;padding:2px;background-color:white;font-weight:bold;', ts, 'color:green;border:1px outset white;padding:2px;margin-left:2px;background-color:white;font-weight:bold;', obj);
            } else {
                console.log('%c%s', 'color:blue;border:1px outset white;padding:2px;background-color:white;font-weight:bold;', ts);
                console.log(obj);
            }
        };
        this.AdSlot = function (r) {
            if (typeof (r) === 'string') {
                if (typeof (document.getElementById(r)) !== 'undefined') {
                    this.root = document.getElementById(r);
                }
            } else {
                this.root = r;
            }
        };
        this.CacheBuster = function (cb) {
        };
        this.UserConsent = function (user_consent) {
            this.user_consent = (user_consent == "%%USER_CONSENT%%") ? 0 : Number(user_consent);
        };
        this.Meta = function (_meta) {
            var meta = _meta.split("/");
            this.partner_id = Number(meta[1].substring(8));
            this.publisher_id = Number(meta[2].substring(8));
            this.ad_unit_id = Number(meta[3].substring(8));
            this.ad_unit_name = meta[4];
        };
        this.Domain = function (_domain) {
            this.domain = _domain;
        };
        this.EnableLog = function (flag) {
            this.enableLog = window.tmsrv.enableLog = flag;
        };
        this.ClickUrl = function (_clickUrl) {
            this.clickUrl = _clickUrl;
        };
        this.ViewURL = function (viewURL) {
        };
        this.Execute = function () {
            window.tmsrv.W = window;
            window.tmsrv.isTopWindow = false;
            window.tmsrv.isRootTop = false;
            var contextual_targeting = false;
            var title = "";
            var meta_keywords = "";
            var meta_description = "";
            var site = "";
            var language = "";
            try {
                window.tmsrv.W = window.top;
                window.tmsrv.isTopWindow = true;
                contextual_targeting = true;
                title = window.tmsrv.W.document.title;
                site = window.tmsrv.W.location.hostname;
                language = window.tmsrv.W.document.documentElement.lang || window.tmsrv.W.document.getElementsByTagName("html")[0].getAttribute("lang");
                try { meta_keywords = Array.from(window.tmsrv.W.document.getElementsByTagName("META")).filter(function (meta) { return meta.name == "keywords"; })[0].content; } catch (ex) { }
                try { meta_description = Array.from(window.tmsrv.W.document.getElementsByTagName("META")).filter(function (meta) { return meta.name == "description"; })[0].content; } catch (ex) { }
            } catch (ex) {
                //this.log(eval(ex));
                this.log('safeframe error, fell back');
                try {
                    window.tmsrv.D = window.tmsrv.W.document;
                } catch (ex1) {
                    window.tmsrv.W = window;
                    window.tmsrv.isTopWindow = false;
                }
            }
            window.tmsrv.D = window.tmsrv.W.document;
            window.tmsrv.W.onbeforeunload=function(e) { return window.tmsrv.stop(); };
            if (this.root == null) return;
            if (this.ad_unit_id != null) {
                var jsonData = {
                    cb: (new Date()).getTime(),
                    id: this.ad_unit_id,
                    what: "req",
                    user_consent: this.user_consent,
                    contextual_targeting: contextual_targeting,
                    title: title,
                    keywords: meta_keywords,
                    description: meta_description,
                    site: site,
                    language: language,
                    url: (window.location.href.substring(0, 500)),
                    domain: this.domain
                };
                window.tmsrv.httpPost(window.tmsrv.ASU+"/req", jsonData, this.init, this);
                //window.tmsrv.IHBRep('reqCount',jsonData);
            }
        };
        this.init = function (list, This) {
            window.tmsrv.log(list);
            if (list.length == 0) return;
            for (var i = 0; i < list.length; ++i) {
                window.tmsrv.instancesMetadata.push(list[i].pid);
                if (list[i].lce > 0 && list[i].type != "play") continue;
                try { list[i].postBid = atob(list[i].postBid); } catch (ex) { }
                //console.log(list[i].creative_content);
                //if (list[i].type != "play") {
                var creative_content = list[i].creative_content;
                //}
                if (typeof (list[i].his) === 'undefined' && typeof (list[i].stdb) === 'undefined' && list[i].type != "play") {
                    if (typeof (creative_content.HbTag) !== 'undefined' && creative_content.HbTag.length > 0) {
                        creative_content.HbTag = creative_content.HbTag;
                    }
                    if (typeof (creative_content.SSPTag) !== 'undefined' && creative_content.SSPTag.length > 0) {
                        creative_content.SSPTag = creative_content.SSPTag;
                    }
                    try {
                        creative_content.tags = [];
                        for (var j = 1; j <= 5; ++j) {
                            if (creative_content["tag" + j].length > 0) {
                                creative_content.tags.push(creative_content["tag" + j]);
                            }
                        }
                        for (var j = 1; j <= 5; ++j) {
                            delete creative_content["tag" + j];
                        }
                    } catch (ex) { }
                    list[i].creative_content = creative_content;
                    if (list[i].type == "play") {
                        This.play(list[i], This);
                    } else if (list[i].type == "stdb") {
                        This.stdb2(list[i], This);
                    } else {
                        This.highImpact2(list[i], This);
                    }
                } else {
                    list[i].creative_content = creative_content;
                    if (list[i].type == "play") {
                        This.play(list[i], This);
                    } else if (list[i].type == "stdb") {
                        This.stdb1(list[i], This);
                    } else {
                        This.highImpact1(list[i], This);
                    }
                }
            }
        };
        this.play = function (jsonResponse, This) {
            //var adData=playerSettings;
            var jsFile = 'https://vsrv-plyr.tmadsrv.com/player.js';
            var initFunction = 'init_vdo';
            //Main player call
            var ctjs = window.tmsrv.D.createElement("script");
            ctjs.src = jsFile;

            ctjs.onload = function () {
                const waitForInit = setInterval(() => {
                    if (window.tmsrv.W && typeof window.tmsrv.W[initFunction] === 'function') {
                        clearInterval(waitForInit);
                        window.tmsrv.W[initFunction](jsonResponse, '', window.tmsrv, This.root);
                    }
                }, 50);
            };

            window.tmsrv.D.head.appendChild(ctjs);
        };
        this.stdb1 = function (jsonResponse, This) {
            var adData = jsonResponse.stdb;
            if (typeof (adData.url) !== 'undefined') {
                if (jsonResponse.header_bidding.length > 0) {
                    if (window.tmsrv.header_bidding == false) {
                        var prebidjs = window.tmsrv.D.createElement("script");
                        prebidjs.src = "//dsrv-prbd.tmadsrv.com/prebid.js";
                        prebidjs.type = "text/javascript";
                        prebidjs.onload = function () {
                            window.tmsrv.header_bidding = true;
                            var jsFile = adData.url.split("~")[0];
                            var initFunction = adData.url.split("~")[1];
                            var ctjs = window.tmsrv.D.createElement("script");
                            ctjs.src = jsFile;
                            if (jsFile.substring("-modular")) {
                                ctjs.onload = function () {
                                    new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                                };
                            } else {
                                ctjs.onload = function () {
                                    window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                                };
                            }
                            window.tmsrv.D.head.appendChild(ctjs);
                        };
                        window.tmsrv.D.head.appendChild(prebidjs);
                    } else {
                        var jsFile = adData.url.split("~")[0];
                        var initFunction = adData.url.split("~")[1];
                        var ctjs = window.tmsrv.D.createElement("script");
                        ctjs.src = jsFile;
                        if (jsFile.substring("-modular")) {
                            ctjs.onload = function () {
                                new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                        } else {
                            ctjs.onload = function () {
                                window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                        }
                        window.tmsrv.D.head.appendChild(ctjs);
                    }
                } else {
                    var jsFile = adData.url.split("~")[0];
                    var initFunction = adData.url.split("~")[1];
                    var ctjs = window.tmsrv.D.createElement("script");
                    ctjs.src = jsFile;
                    if (jsFile.substring("-modular")) {
                        ctjs.onload = function () {
                            new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                    } else {
                        ctjs.onload = function () {
                            window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                    }
                    window.tmsrv.D.head.appendChild(ctjs);
                }
            }
        };
        this.highImpact1 = function (jsonResponse, This) {
            var adData = jsonResponse.his;
            if (typeof (adData.url) !== 'undefined') {
                if (jsonResponse.header_bidding.length > 0) {
                    if (window.tmsrv.header_bidding == false) {
                        var prebidjs = window.tmsrv.D.createElement("script");
                        prebidjs.src = "//dsrv-prbd.tmadsrv.com/prebid.js";
                        prebidjs.type = "text/javascript";
                        prebidjs.onload = function () {
                            window.tmsrv.header_bidding = true;
                            var jsFile = adData.url.split("~")[0];
                            var initFunction = adData.url.split("~")[1];
                            var ctjs = window.tmsrv.D.createElement("script");
                            ctjs.src = jsFile;
                            if (jsFile.substring("-modular")) {
                                ctjs.onload = function () {
                                    new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                                };
                            } else {
                                ctjs.onload = function () {
                                    window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                                };
                            }
                            window.tmsrv.D.head.appendChild(ctjs);
                        };
                        window.tmsrv.D.head.appendChild(prebidjs);
                    } else {
                        var jsFile = adData.url.split("~")[0];
                        var initFunction = adData.url.split("~")[1];
                        var ctjs = window.tmsrv.D.createElement("script");
                        ctjs.src = jsFile;
                        if (jsFile.substring("-modular")) {
                            ctjs.onload = function () {
                                new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                        } else {
                            ctjs.onload = function () {
                                window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                        }
                        window.tmsrv.D.head.appendChild(ctjs);
                    }
                } else {
                    var jsFile = adData.url.split("~")[0];
                    var initFunction = adData.url.split("~")[1];
                    var ctjs = window.tmsrv.D.createElement("script");
                    ctjs.src = jsFile;
                    if (jsFile.substring("-modular")) {
                        ctjs.onload = function () {
                            new window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                    } else {
                        ctjs.onload = function () {
                            window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                    }
                    window.tmsrv.D.head.appendChild(ctjs);
                }
            }
        };
        this.stdb2 = function (jsonResponse, This) {
            var adData = jsonResponse.creative_content;
            if (typeof (adData.url) !== 'undefined') {
                if (jsonResponse.header_bidding.length > 0) {
                    if (window.tmsrv.header_bidding == false) {
                        var prebidjs = window.tmsrv.D.createElement("script");
                        prebidjs.src = "//dsrv-prbd.tmadsrv.com/prebid.js";
                        prebidjs.type = "text/javascript";
                        prebidjs.onload = function () {
                            window.tmsrv.header_bidding = true;
                            var jsFile = adData.url.split("~")[0];
                            var initFunction = adData.url.split("~")[1];
                            var ctjs = window.tmsrv.D.createElement("script");
                            ctjs.src = jsFile;
                            ctjs.onload = function () {
                                window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                            window.tmsrv.D.head.appendChild(ctjs);
                        };
                        window.tmsrv.D.head.appendChild(prebidjs);
                    } else {
                        var jsFile = adData.url.split("~")[0];
                        var initFunction = adData.url.split("~")[1];
                        var ctjs = window.tmsrv.D.createElement("script");
                        ctjs.src = jsFile;
                        ctjs.onload = function () {
                            window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                        window.tmsrv.D.head.appendChild(ctjs);
                    }
                } else {
                    var jsFile = adData.url.split("~")[0];
                    var initFunction = adData.url.split("~")[1];
                    var ctjs = window.tmsrv.D.createElement("script");
                    ctjs.src = jsFile;
                    ctjs.onload = function () {
                        window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                    };
                    window.tmsrv.D.head.appendChild(ctjs);
                }
            }
        };
        this.highImpact2 = function (jsonResponse, This) {
            var adData = jsonResponse.creative_content;
            if (typeof (adData.url) !== 'undefined') {
                if (jsonResponse.header_bidding.length > 0) {
                    if (window.tmsrv.header_bidding == false) {
                        var prebidjs = window.tmsrv.D.createElement("script");
                        prebidjs.src = "//dsrv-prbd.tmadsrv.com/prebid.js";
                        prebidjs.type = "text/javascript";
                        prebidjs.onload = function () {
                            window.tmsrv.header_bidding = true;
                            var jsFile = adData.url.split("~")[0];
                            var initFunction = adData.url.split("~")[1];
                            var ctjs = window.tmsrv.D.createElement("script");
                            ctjs.src = jsFile;
                            ctjs.onload = function () {
                                window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                            };
                            window.tmsrv.D.head.appendChild(ctjs);
                        };
                        window.tmsrv.D.head.appendChild(prebidjs);
                    } else {
                        var jsFile = adData.url.split("~")[0];
                        var initFunction = adData.url.split("~")[1];
                        var ctjs = window.tmsrv.D.createElement("script");
                        ctjs.src = jsFile;
                        ctjs.onload = function () {
                            window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                        };
                        window.tmsrv.D.head.appendChild(ctjs);
                    }
                } else {
                    var jsFile = adData.url.split("~")[0];
                    var initFunction = adData.url.split("~")[1];
                    var ctjs = window.tmsrv.D.createElement("script");
                    ctjs.src = jsFile;
                    ctjs.onload = function () {
                        window.tmsrv.W[initFunction](This.root, jsonResponse, window.tmsrv);
                    };
                    window.tmsrv.D.head.appendChild(ctjs);
                }
            }
        };
    };

    window.tmsrv.imp=function(ad_unit_id, pid, tid, viewability) {
        window.tmsrv.sendBeacon({
            what: "imp",
            AdUnitID: ad_unit_id,
            pid: pid,
            tid: tid,
            viewability: viewability
        });
    };
    window.tmsrv.click=function(ad_unit_id, pid, tid) {
        window.tmsrv.sendBeacon({
            what: "click",
            AdUnitID: ad_unit_id,
            pid: pid,
            tid: tid
        });
    };
    window.tmsrv.rreq=function(ad_unit_id, pid, callback) {
        var jsonRequest = {
            cb: (new Date()).getTime(),
            AdUnitID: ad_unit_id,
            what: "rreq",
            pid: pid
        };
        window.tmsrv.httpPost(window.tmsrv.ASU+"/rreq", jsonRequest, function (adUnit) {
            window.tmsrv.log(adUnit);
            if (adUnit === "[]") return;
            if (adUnit.lce == 0) {
                callback(adUnit);
            }
        }, null);
    };
    window.tmsrv.rimp=function (ad_unit_id, pid, tid, viewability) {
        window.tmsrv.sendBeacon({
            what: "rimp",
            AdUnitID: ad_unit_id,
            pid: pid,
            tid: tid,
            viewability: viewability
        });
    };
    window.tmsrv.rclick=function(ad_unit_id, pid, tid) {
        window.tmsrv.sendBeacon({
            what: "rclick",
            id: ad_unit_id,
            pid: pid,
            tid: tid
        });
    };
    window.tmsrv.pload=function(ad_unit_id, pid, tid, viewability) {
        window.tmsrv.sendBeacon({
            what: "pload",
            id: ad_unit_id,
            pid: pid,
            tid: tid,
            viewability: viewability
        });
    };
    window.tmsrv.stop=function(){
        /*e.preventDefault(); e.returnValue=true;*/
        window.tmsrv.sendBeacon({
            what: "stop",
            list: window.tmsrv.instancesMetadata
        });
    };
    window.tmsrv.tevt = function (args, retries = 3) {
        const status = navigator.sendBeacon(window.tmsrv.ASU_Re, JSON.stringify(args));

        if (!status && retries > 0) {
            setTimeout(() => {
                window.tmsrv.tevt(args, retries - 1);
            }, 100);
        } else if (!status) {
            console.warn("sendBeacon failed after max retries:", args);
        }
    };
}

